createuser "{{ result.db_user }}" --no-createrole --no-createdb --no-inherit --no-superuser -U postgres 2> /dev/null
createdb "{{ result.db_name }}" --owner="{{ result.db_user }}" -U postgres 2> /dev/null

if [ "$?" = "0" ] ; then
    psql -d "{{ result.db_name }}" -U "{{ result.db_user }}" --file="../vendor/jrealm/dungeons/doc/dungeons.sql" --quiet 2>&1 | grep -v ": NOTICE:"

    if [ -f ../doc/schema.sql ] ; then
        psql -d "{{ result.db_name }}" -U "{{ result.db_user }}" --file="../doc/schema.sql" --quiet 2>&1 | grep -v ": NOTICE:"
    fi

    php index.php /console/init-multilingual

    if [ -f ../doc/data.sql ] ; then
        psql -d "{{ result.db_name }}" -U "{{ result.db_user }}" --file="../doc/data.sql" --quiet 2>&1 | grep -v ": NOTICE:"
    fi
fi
